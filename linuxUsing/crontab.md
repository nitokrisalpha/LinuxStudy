# 例行性工作

> 什么是例行性工作

    直接点就是每天都要干的事

## Linux工作调度的种类 at,cron

> 有两种工作调度方式，例行性的和突发性的

    例行性的：每隔一定周期要办的事项

    突发性的：这次搞定之后就没了

> 功能的实现

    at：可以处理仅执行一次就结束调度的命令，不过必须要开启 atd 服务

    crontab：这个命令设置的工作将会一直进行下去，可循环的时间为分钟，小时，每周，每月或每年，除了可以用命令执行，也可以用 /etc/crontab 来支持 其对应的服务是 crond

> 常见的例行性工作

    ***略***

## 仅执行一次的工作调度

> at命令的管理

    使用at命令时 系统会在 /var/spool/at/目录内生成文本文件，但为了安全，可以利用 /etc/at.allow 和 /etc/at.deny 这两个文件来配置可以运行at 命令的用户

* at的工作流程

    1.先寻找 /etc/at.allow 这个文件，写在这个文件里的用户才能使用at，没在这个文件中的用户则不能使用at (即使该用户没有在 at.deny中)

    2.如果 /etc/at.allow 不存在，就寻找 /etc/at.deny 这个文件，若某用户被写入了这个文件，则这个用户不能使用at，没有在这个文件的用户可以使用

    3.如果这两个文件都不存在，则只有root能使用at命令

> at运行单一工作调度

* 语法如下

``` shell
    at [-mldv] TIME
    at -c 工作号码
    参数：
        -m : 当at的工作完成以后，即使没有输出信息，也会以 email 通知该用户工作已完成
        -l ：at -l 相当于 atq，列出目前系统上面的所有该用户的at调度
        -d ：相当于 atrm 可以取消一个在at调度中的工作
        -v ：可以使用较明显的时间格式列出 at调度中的任务列表
        -c ：可以列出后面接的该项工作的实际命令内容
        TIME ：时间格式，可以定义什么时候要进行 at 这项工作的时间
```

## 循环执行的例行性工作调度

    相对于at是仅执行一次的工作，循环执行的例行性工作调度是由 cron 这个服务来控制的

> 用户的设置

* 和at命令一样，为了安全，也需要设置能够使用 crontab 这个命令的用户

    /etc/cron.allow 在这个文件中的用户可以使用crontab

    /etc/cron.deny 将不可以使用crontab的用户写入其中

    注：上述两个文件只会选择一个文件来限制，且 cron.allow 的优先级高于 cron.deny 

    当用户使用crontab这个命令来新建工作调度之后，该项工作会被记录到 /var/spool/cron/ 里面，且以账号来作为判别。举例来说 root使用crontab后，他的工作会被记录到 /var/spool/cron/root 里面

    另外，crontab执行的命令会保存到 /var/log/cron 这个日志文件中，可以通过查询这个文件来判断你的linux是否有被执行

* crontab的语法

``` shell
    crontab [-u username] [-l|-e|-r]
    参数：
        -u：root才能执行这个任务，即帮其他用户新建/删除crontab工作调度
        -e：编辑crontab的工作内容
        -l：查询crontab的工作内容
        -r：删除所有的crontab的工作内容
```

* 针对系统的配置文件 /etc/crontab

    crontab -e 是针对用户来设计的，系统的定时任务只需要编辑 /etc/crotab 这个文件就可以
