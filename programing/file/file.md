# linux 文件结构

    linux中一切皆文件，他为操作系统服务和设备提供了简单而统一的接口

## 文件和设备

    linux 中设备通常也被映射为文件，linux中比较重要的设备文件有三个:
        /dev/console    : 控制台文件
        /dev/tty        : 终端文件
        /dev/null       : 空文件，所有写向这个设备的文件都会被丢弃

## 系统调用

    使用少量函数就可以对文件和设备进行访问和控制。这些函数被成为系统调用，由系统提，操作系统的核心部分称为内核，是一组驱动程序，是一组对硬件进行控制的底层接口，为了向用户提供一个一致的接口，设备驱动程序封装了所有与硬件相关的特性。硬件特有的功能通常可用过ioctl系统调用来提供
    下面是用于访问设备驱动程序的系统调用
        open    : 打开文件或者设备
        read    : 从打开的文件或设备里读取数据
        write   : 向文件或设备写数据
        close   : 关闭文件或设备
        ioctl   : 把控制信息传递给设备驱动程序

## 库函数

    由于系统调用的性能很低，为了给设备和磁盘文件提供一个更高层的接口，linux发行版提供了一系列标准库函数

## 底层文件访问

    每个运行中的程序被称为进程，他有一些与之关联的文件描述符，系统中一般会有以下三个文件描述符
        0   : 标准输入
        1   : 标准输出
        2   : 标准错误

### write系统调用

    wirte系统调用的功能是向系统缓冲区写入前nbytes数据，其返回值是写入的字节数，如果返回0则表示没有写入任何数据，如果是-1则表示写入数据失败，错误代码保存在全局变量errno里(示例代码见write.c)

### read系统调用

    read系统调用是从文件描述符fildes相关联的文件里读入nbytes个字节数据，并把他们放到数据区buf中。返回实际读入的字节数，如果返回0，就表示未读入任何数据，已达到了文件尾。同样，如果返回的是-1，就表示read调用出现了错误(示例代码见read.c)

### open系统调用

    前面我们提到了系统描述符，有时候我们不想使用系统的文件描述符可以自己创建,这时候你需要使用系统调用open，open建立了一条从文件或设备访问路径。如果调用成功，他将返回一个可以被read,write，和其他系统调用使用的文件描述符，这个文件描述符是唯一的，不会被其他任何运行中的程序共享 int open(const char *path,int oflags,mod_t mode),第一个参数是文件路径，第二个参数是打开模式，第三个参数是可选模式
        第二个参数的可选模式
        O_RDONLY : 以只读方式打开
        O_WRONLY : 以只写方式打开
        O_RDWR   : 以读写方式打开
        O_APPEND : 把写入数据追加在文件的末尾
        O_TRUNC  : 把文件长度设置为0，丢弃已有内容
        O_CREAT  : 如果需要，就按参数mode 中给出的模式访问文件
        O_EXCL   : 与O_CREAT一起使用，确保调用者创建出文件
        第三个参数的模式(使用O_CREAT标志时必须要有下面的参数)
        S_IRUSR : 读权限，文件属主
        S_IWUSR : 写权限，文件属主
        S_IXUSR : 执行权限，文件属主
        S_IRGRP : 读权限，文件属组
        S_IWGRP : 写权限，文件属组
        S_IXGRP : 执行权限，文件属组
        S_IROTH : 读权限，其他用户
        S_IWOTH : 写权限，其他用户
        S_IXOTH : 执行权限，其他用户
    示例代码见 open.c

### close系统调用

    我们之前用open打开了一个文件描述符，现在我们可以使用close调用终止文件描述符fildes与其对应文件之间的关联。文件描述符被释放并能够重新使用。close调用成功时返回0，出错返回-1

### ioctl调用

    int ioctl(int fildes,int cmd,...)
    ioctl对描述符fildes引用的对象执行cmd参数中给出的操作。根据特定设备所支持的操作不同可能还有一个可选的第三参数

### 应用

    一个文件复制程序
    利用open read write 系统调用，代码见copyfile.c

### 补充

    见书 P89